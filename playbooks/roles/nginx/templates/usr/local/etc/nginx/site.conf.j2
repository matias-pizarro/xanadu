{% if 'upstreams' in item %}
{% for upstream in item.upstreams %}
upstream {{ upstream.name }} {
{% if 'servers' in upstream %}
{% for server in upstream.servers %}
    server     {{ server }};
{% endfor %}
{% endif %}
{% if 'keepalive' in upstream %}
    keepalive  {{ upstream.keepalive }};
{% endif %}
}

{% endfor %}
{% endif %}
server {
    listen       localhost:80;
    server_name  {{ item.fqdns }};
{% if 'root' in item %}
    root         {{ item.root }};
{% endif %}
{% if 'index' in item %}
    index        {{ item.index }};
{% endif %}
{% if 'max_upload_size' in item %}

    client_max_body_size  {{ item.max_upload_size }};
{% endif %}
{% if 'locations' in item %}
{% for location in item.locations %}

    location {{ location.base }} {
{% for conf in location.confs %}
{% if conf[0] == 'location' %}
        {{ conf[0] }} {{ conf[1] }}
{% else %}
        {{ conf[0] }}  {{ conf[1] }};
{% endif %}
{% endfor %}
    }
{% endfor %}
{% endif %}
{% if 'includes' in item %}

{% for include in item.includes %}
    include {{ include }};
{% endfor %}
{% endif %}
}
