---

- name: create property lists
  set_fact:
    packages: []
    services: []
  tags: set_properties

- name: populate property lists
  set_fact:
    packages: "{{ packages | union(item.packages) | unique }}"
    services: "{{ services | union(item.services) | unique }}"
  when: item.group in group_names
  with_items: "{{ properties }}"
  tags: set_properties

- name: retrieve jail facts
  set_fact:
    features: "{{ features | union(hostvars[item].features) | unique }}"
  when: host_type == "jail_host" and jails|length > 0
  with_items: "{{ jails }}"
  tags: set_properties

...
