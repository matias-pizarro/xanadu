---

- name: Create /etc/pf directory
  file:
    path=/etc/pf
    state=directory
    owner=0
    group=0
    mode=755

- name: Create /etc/pf/ssh.rdr.conf
  file:
    path=/etc/pf/ssh.rdr.conf
    state=touch
    owner=0
    group=0
    mode=644

- name: configure pf rules
  template: src=pf.conf.j2
    dest=/etc/pf.conf owner=0 group=0 mode=0644
    validate='/sbin/pfctl -nf %s'
  tags: pf
  notify:
    - start pf
    - load pf rules
    - partial pf flush

- name: enable pf
  command: /usr/sbin/sysrc pf_enable=YES
  tags: pf
  notify:
    - start pf
    - partial pf flush

- name: enable pflog
  command: /usr/sbin/sysrc pflog_enable=YES
  tags: pf
  notify:
    - start pflog

...
